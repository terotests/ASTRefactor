(function(){var e={},t=function(){!function(e){e.on=function(e,t){return this._ev||(this._ev={}),this._ev[e]||(this._ev[e]=[]),this._ev[e].push(t),this},e.removeListener=function(e,t){if(this._ev&&this._ev[e])for(var i=this._ev[e],s=0;s<i.length;s++)if(i[s]==t)return void i.splice(s,1)},e.trigger=function(e,t,i){if(this._ev&&this._ev[e]){return this._ev[e].forEach(function(e){e(t,i)}),this}}}(this),function(e){e.diff_nodes=function(e,t,i){try{if(i.failed)return!0;if(!e&&!t)return;if(e&&!t||!e&&t)return i.failed=!0,!0;var s=this.v_list;if(e instanceof Array&&t instanceof Array){for(var n,r=-1,o=0;o<t.length;o++){var f=t[o];if("ExpressionStatement"==f.type&&(f=f.expression),f&&"Literal"==f.type&&"...rest"==f.value){r=o,n=f;break}}var d=e.length;if(r>=0&&r>=d)return i.failed=!0,!0;for(var o=0;d>o;o++){var f=e[o],a=t[o],p=a;if(!p)return i.failed=!0,!0;if("ExpressionStatement"==p.type&&(p=p.expression),p&&"Literal"==p.type&&"...rest"==p.value){i.slots["...rest"]={srcArray:e,tplArray:t,tplNodeIndex:r,tplNode:n};break}this.diff_nodes(f,a,i)}return}if("Identifier"==t.type&&t.name&&t.name&&s.indexOf(t.name)>=0)return void("codeBlock"==t.name||(i.slots[t.name]=e));if(e.type!=t.type)return i.failed=!0,!0;if("Literal"==e.type&&e.value!=t.value)return i.failed=!0,!0;if("Identifier"==e.type&&e.name!=t.name)return i.failed=!0,!0;if("MemberExpression"==e.type){if(e.computed!=t.computed)return i.failed=!0,!0;this.diff_nodes(e.property,t.property,i),this.diff_nodes(e.object,t.object,i)}if("FunctionDeclaration"==e.type){if(e.generator!=t.generator)return i.failed=!0,!0;this.diff_nodes(e.params,t.params,i,"params"),this.diff_nodes(e.body,t.body,i,"params"),this.diff_nodes(e.id,t.id,i)}if("ArrowFunctionExpression"==e.type){if(e.generator!=t.generator)return i.failed=!0,!0;this.diff_nodes(e.params,t.params,i,"params"),this.diff_nodes(e.body,t.body,i,"body"),this.diff_nodes(e.id,t.id,i)}if("FunctionExpression"==e.type){if(e.generator!=t.generator)return i.failed=!0,!0;this.diff_nodes(e.params,t.params,i,"params"),this.diff_nodes(e.body,t.body,i,"body"),this.diff_nodes(e.id,t.id,i)}if("TryStatement"==e.type&&(this.diff_nodes(e.block,t.block,i,"block"),this.diff_nodes(e.handler,t.handler,i,"handler"),this.diff_nodes(e.finalizer,t.finalizer,i,"finalizer")),"CallExpression"==e.type&&(this.diff_nodes(e.callee,t.callee,i,"callee"),this.diff_nodes(e.arguments,t.arguments,i,"arguments")),"SequenceExpression"==e.type&&this.diff_nodes(e.expressions,t.expressions,i,"expressions"),"BlockStatement"==e.type&&this.diff_nodes(e.body,t.body,i,"body"),"VariableDeclaration"==e.type&&this.diff_nodes(e.declarations,t.declarations,i,"declarations"),"YieldExpression"==e.type&&this.diff_nodes(e.argument,t.argument,i,"argument"),"ReturnStatement"==e.type&&this.diff_nodes(e.argument,t.argument,i),"BreakStatement"==e.type&&this.diff_nodes(e.label,t.label,i),"MethodDefinition"==e.type&&(this.diff_nodes(e.key,t.key,i),this.diff_nodes(e.value,t.value,i)),"ClassDeclaration"==e.type&&(this.diff_nodes(e.id,t.id,i),this.diff_nodes(e.superClass,t.superClass,i),this.diff_nodes(e.body,t.body,i,"body")),"ClassBody"==e.type&&this.diff_nodes(e.body,t.body,i,"body"),"CatchClause"==e.type&&(this.diff_nodes(e.param,t.param,i,"param"),this.diff_nodes(e.body,t.body,i,"body")),"NewExpression"==e.type&&(this.diff_nodes(e.callee,t.callee,i),this.diff_nodes(e.arguments,t.arguments,i,"arguments")),"ConditionalExpression"==e.type&&(this.diff_nodes(e.test,t.test,i,"test"),this.diff_nodes(e.consequent,t.consequent,i),this.diff_nodes(e.alternate,t.alternate,i)),"DebuggerStatement"==e.type,"ThrowStatement"==e.type&&this.diff_nodes(e.argument,t.argument,i),"BlockStatement"==e.type&&this.diff_nodes(e.body,t.body,i,"body"),"LabeledStatement"==e.type&&(this.diff_nodes(e.label,t.label,i),this.diff_nodes(e.body,t.body,i,"body")),"LogicalExpression"==e.type){if(e.operator!=t.operator)return i.failed=!0,!0;this.diff_nodes(e.left,t.left,i),this.diff_nodes(e.right,t.right,i)}if("UnaryExpression"==e.type){if(e.operator!=t.operator)return i.failed=!0,!0;this.diff_nodes(e.argument,t.argument,i)}if("Program"==e.type&&this.diff_nodes(e.body,t.body,i,"body"),"UpdateExpression"==e.type){if(e.operator!=t.operator)return i.failed=!0,!0;this.diff_nodes(e.argument,t.argument,i)}if("Property"==e.type){if(e.shorthand!=t.shorthand)return i.failed=!0,!0;this.diff_nodes(e.key,t.key,i),this.diff_nodes(e.value,t.value,i)}if("ArrayPattern"==e.type&&this.diff_nodes(e.elements,t.elements,i,"elements"),"ArrayExpression"==e.type&&this.diff_nodes(e.elements,t.elements,i,"elements"),"ObjectPattern"==e.type&&this.diff_nodes(e.properties,t.properties,i,"properties"),"ObjectExpression"==e.type&&this.diff_nodes(e.properties,t.properties,i,"properties"),"RestElement"==e.type&&this.diff_nodes(e.argument,t.argument,i),"IfStatement"==e.type&&(this.diff_nodes(e.test,t.test,i),this.diff_nodes(e.consequent,t.consequent,i),this.diff_nodes(e.alternate,t.alternate,i)),"Super"==e.type&&this.diff_nodes(e.test,t.test,i),"SwitchStatement"==e.type&&(this.diff_nodes(e.discriminant,t.discriminant,i),this.diff_nodes(e.cases,t.cases,i,"cases")),"SwitchCase"==e.type&&(this.diff_nodes(e.test,t.test,i),this.diff_nodes(e.consequent,t.consequent,i)),"ForOfStatement"==e.type&&(this.diff_nodes(e.left,t.left,i),this.diff_nodes(e.right,t.right,i),this.diff_nodes(e.body,t.body,i,"body")),"ForInStatement"==e.type&&(this.diff_nodes(e.left,t.left,i),this.diff_nodes(e.right,t.right,i),this.diff_nodes(e.body,t.body,i,"body")),"ForStatement"==e.type&&(this.diff_nodes(e.init,t.init,i),this.diff_nodes(e.test,t.test,i),this.diff_nodes(e.update,t.update,i),this.diff_nodes(e.body,t.body,i,"body")),"WhileStatement"==e.type&&(this.diff_nodes(e.test,t.test,i),this.diff_nodes(e.body,t.body,i,"body")),"DoWhileStatement"==e.type&&(this.diff_nodes(e.test,t.test,i),this.diff_nodes(e.body,t.body,i,"body")),"BinaryExpression"==e.type){if(e.operator!=t.operator)return i.failed=!0,!0;this.diff_nodes(e.left,t.left,i),this.diff_nodes(e.right,t.right,i)}if("VariableDeclarator"==e.type){if(e.kind!=t.kind)return i.failed=!0,!0;this.diff_nodes(e.id,t.id,i),this.diff_nodes(e.init,t.init,i)}if("ExpressionStatement"==e.type&&this.diff_nodes(e.expression,t.expression,i),"AssignmentExpression"==e.type){if(e.operator!=t.operator)return i.failed=!0,!0;this.diff_nodes(e.left,t.left,i),this.diff_nodes(e.right,t.right,i)}}catch(l){i.failed=!0}},e.__traitInit&&!e.hasOwnProperty("__traitInit")&&(e.__traitInit=e.__traitInit.slice()),e.__traitInit||(e.__traitInit=[]),e.__traitInit.push(function(e){this._structures=[],this._tabChar="  ",this._codeStr="",this._currentLine="",this._indent=0,this._options=e||{}}),e.refactor=function(e,t,i,s){var n=s,r=e.split(",").map(function(e){return e.trim()});this.v_list=r;var o=esprima.parse(t),f=esprima.parse(i);"Program"==o.type&&(o=o.body.shift()),"Program"==f.type&&(f=f.body.shift()),"ExpressionStatement"==o.type&&(o=o.expression);var d=ASTWalker(),a=this;d.on("node",function(e){var t=e.node,s={slots:{}};if(a.diff_nodes(t,o,s),!s.failed){var n=!0;if(r.forEach(function(e){s.slots[e]||(n=!1)}),n){var f=ASTWalker(),d=esprima.parse(i);"Program"==d.type&&(d=d.body.shift()),"ExpressionStatement"==d.type&&(d=d.expression),f.on("Literal",function(e){var t=e.node,i=t.value,n=s.slots[i];if(n&&"...rest"==i&&n.srcArray){var r=n.tplNodeIndex,o=f.getParent(t);if("ExpressionStatement"==o.type&&(t=o,o=f.getParent(o)),o.body){for(var d=o.body.indexOf(t),a=n.srcArray.length-r,p=d;a>0;a--,p++)o.body[p]=n.srcArray[r++];return}}}),f.on("Identifier",function(e){var t=e.node,i=t.name,n=s.slots[i];n&&Object.keys(n).forEach(function(e){t[e]=n[e]})}),f.startWalk(d,{functions:{},vars:{}}),Object.keys(d).forEach(function(e){t[e]=d[e]})}}}),d.startWalk(n,{functions:{},vars:{}});var p=ASTWalker();return p.startWalk(n,{functions:{},vars:{}}),{code:p.getCode(),ast:n}}}(this)},i=function(e,t,s,n,r,o,f,d){var a,p=this;if(!(p instanceof i))return new i(e,t,s,n,r,o,f,d);var l=[e,t,s,n,r,o,f,d];if(p.__factoryClass)if(p.__factoryClass.forEach(function(e){a=e.apply(p,l)}),"function"==typeof a){if(a._classInfo.name!=i._classInfo.name)return new a(e,t,s,n,r,o,f,d)}else if(a)return a;p.__traitInit?p.__traitInit.forEach(function(e){e.apply(p,l)}):"function"==typeof p.init&&p.init.apply(p,l)};i._classInfo={name:"ASTRefactor"},i.prototype=new t,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(e.ASTRefactor=i,this.ASTRefactor=i):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.ASTRefactor=i:this.ASTRefactor=i}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(e)}).call(new Function("return this")());